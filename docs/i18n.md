# ðŸŒ i18n Singleton and Scoped Composable

This document explains how to use the shared i18n singleton and the `useScopedI18n` composable to manage translations in
your application.

---

## 1. Overview

The i18n singleton provides a **shared instance of `vue-i18n`** across all modules. It ensures that all modules use the
same translation store, avoiding duplication and inconsistencies.

The `useScopedI18n` composable allows you to create a **scoped translation function** bound to a specific namespace,
automatically prefixing all translation keys.

---

## 2. Shared i18n Singleton

### 2.1 Initialization

The shared i18n instance must be initialized **once** by the host application during boot:

```ts
import { createI18n } from 'vue-i18n';
import { setI18nInstance } from '@linagora/linid-im-front-corelib';
import messages from 'public/i18n/messages.json';

const i18n = createI18n({
  locale: 'en',
  fallbackLocale: 'fr',
  messages,
});

setI18nInstance(i18n);
```

> âš ï¸ Subsequent calls to `setI18nInstance()` are ignored.
> Accessing the instance via `getI18nInstance()` before initialization will throw an error.

### 2.2 Accessing the Singleton

You can retrieve the shared i18n instance anywhere in your code:

```ts
import { getI18nInstance } from '@linagora/linid-im-front-corelib';

const i18n = getI18nInstance();
i18n.global.locale = 'fr';
```

* `getI18nInstance()` returns the **same instance** everywhere.
* Ensures consistent locale, messages, and formatting across modules.

---

## 3. Using the `useScopedI18n` Composable

The `useScopedI18n(scope: string)` composable creates a scoped `t` function bound to a **translation namespace**.

### 3.1 Import and Setup

```ts
import { useScopedI18n } from '@linagora/linid-im-front-corelib';

const { t } = useScopedI18n('user.profile');
```

* All translation keys will be automatically prefixed with `user.profile`.
* Example: `t('name')` â†’ `'user.profile.name'`.

### 3.2 Using `t`

The `t` function supports all overloads of Vue I18n's `t`:

1. **Simple translation**

```ts
t('name'); // translates 'user.profile.name'
```

2. **Named interpolation**

```ts
t('greeting', { username: 'Alice' });
// translates 'user.profile.greeting' replacing {{ username }} with 'Alice'
```

3. **Pluralization**

```ts
t('messages', 5);
// translates 'user.profile.messages' using plural rules
```

4. **Advanced options**

```ts
t('key', { count: 3, somethingElse: 'value' });
```

---

## 4. Full Example in a Vue 3 + Quasar Component

```vue

<script setup lang="ts">
  import { useScopedI18n } from '@linagora/linid-im-front-corelib';

  const { t } = useScopedI18n('user.profile');

  const welcomeMessage = t('greeting', { username: 'Alice' });
</script>

<template>
  <q-page>
    <h1>{{ welcomeMessage }}</h1>
  </q-page>
</template>
```

* Keys are automatically prefixed with the specified namespace.
* The same component can be reused with different namespaces.

---

## 5. Best Practices

* Always call `setI18nInstance()` **once** during app boot.
* Use descriptive namespaces for different modules or features.
* Keep translation keys organized and avoid deeply nested structures unless necessary.
* Use `useScopedI18n` in components to reduce repetition and ensure correct namespace scoping.

---

## 6. TypeScript Support

The composable preserves type safety with Vue I18n's `ComposerTranslation` type:

```ts
import { ComposerTranslation } from 'vue-i18n';

const { t } = useScopedI18n('user.profile');

const message: string = t('greeting', { username: 'Alice' });
```

* Supports key-only, pluralization, named interpolation, and options overloads.
